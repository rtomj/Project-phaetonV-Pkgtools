#!/sbin/sh

##
## pkg: SVR4 package tools wrapper
##
. /usr/bin/pkgconf

PKG_ADD="/usr/5bin/pkgadd -d"
PKG_AD="/usr/5bin/pkgadd"
PKG_RM="/usr/5bin/pkgrm"
PKG_TRANS="/usr/5bin/pkgtrans"
PKG_LOC="/var/spool/pkg"
PKG_CK="/usr/5bin/pkginfo"

envir() {
num="`ls $PKG_LOC | grep pkg | wc -l`"
echo "
No. of Stream Packages (*.pkg) in cache: $num
Package cache location:                  $PKG_LOC
SVR4 package tools:                      $PKG_ADD
                                         $PKG_RM
                                         $PKG_PROTO
                                         $PKG_TRANS
"
}

usage() {
echo "
usage: pkg search|build|install|update|remove|delete|verify|sync|list|env|help

search  - searches the repository for an SVR4 package
build   - uses pkgbuild to build a port
install - installs SVR4 package
update  - update packages
remove  - uninstalls a package but does not delete it from cache
delete  - deletes package from cache and system
sync    - sync with repository
list    - list all installed packages
verify  - verify hashes of packages
env     - outputs pkg environment, package cache location
help    - outputs this message
"
}

case $1 in
	install*|update*|remove*|delete*|build*|sync*)
    	if [ $USER != root ]; then
        	echo "You must be root"
        	exit 1
    	elif [ $USER = root ]; then
		case $1 in
			install*)
            ## Added statement so that a package with a version no. can be installed
            $PKG_ADD $PKG_LOC/$2-*.pkg
            ;;
            update*)
            echo "TODO"
            ;;
		    remove*)
			$PKG_RM $2
			;;
            delete*)
            rm $PKG_LOC$2-*.pkg
            ;;
            build*)
            echo "TODO: add this functionality to pkgbuild"
            ;;
            sync*)
            echo "TODO"
            ;;
		esac
	    fi
    ;;
    search*)
    echo "TODO"
    ;;
    list*)
    $PKG_CK
    ;;
    help*)
    usage
    ;;
    verify*)
    sha256sum $PKG_LOC/$2-*.pkg
    ;;
    env*)
    envir
    ;;
    *)
    usage
    ;;
esac

